<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Compare with Tidyr's Rectangling</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Compare with Tidyr's Rectangling</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>As per <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a> definition unnesting (or rectangling):</p>
<pre><code> ... is the art and craft of taking a deeply nested list (often sourced
 from wild caught JSON or XML) and taming it into a tidy data set of rows and
 columns. There are three functions from tidyr that are particularly useful for
 rectangling:</code></pre>
<p><a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a> core functions for unnesting are <code>unnest_longer()</code>, <code>unnest_wider()</code>, <code>hoist()</code>. This guide follows the steps from <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a> vignette and translates them into <code>unnest</code>'s language.</p>
<p>With <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a> you have to unnest lists in several steps by using one of the three core functions. With <code>unnest</code> you do all at once in one step. <code>unnest</code> doesn't produce intermediate list columns.</p>
<p>We'll use the <code>repurrrsive</code> package as the source of our nested lists:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
<span class="co">#&gt; Warning: replacing previous import 'lifecycle::last_warnings' by</span>
<span class="co">#&gt; 'rlang::last_warnings' when loading 'pillar'</span>
<span class="co">#&gt; Warning: replacing previous import 'lifecycle::last_warnings' by</span>
<span class="co">#&gt; 'rlang::last_warnings' when loading 'tibble'</span>
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(repurrrsive)
<span class="kw">library</span>(unnest)
<span class="kw">options</span>(<span class="dt">unnest.return.type =</span> <span class="st">&quot;tibble&quot;</span>)</code></pre></div>
</div>
<div id="github-repos" class="section level2">
<h2>GitHub repos</h2>
<p>With <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a> you start by putting a list into a data.frame column. With <a href="https://vspinu.github.io/unnest/">unnest</a> this is not necessary.</p>
<p><code>gh_repos</code> is a nested list with maximal depth of 4 &quot;user&quot;&gt;&quot;repo&quot;&gt;&quot;owner&quot;&gt;&quot;[xyz]&quot;.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(gh_repos[[<span class="dv">1</span>]][[<span class="dv">1</span>]][[<span class="st">&quot;owner&quot;</span>]])</code></pre></div>
<p>Let's say that we want a <code>data.frame</code> with 3 columns, &quot;name&quot;, &quot;homepage&quot; and &quot;watchers_count&quot;, from level 3 of repo characteristics and one,&quot;login&quot;, from level 4 of owner characteristics. This is how it's done with <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">repos &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">repo =</span> gh_repos)
repos &lt;-<span class="st"> </span><span class="kw">unnest_longer</span>(repos, repo)
<span class="kw">hoist</span>(repos, repo,
      <span class="dt">login =</span> <span class="kw">c</span>(<span class="st">&quot;owner&quot;</span>, <span class="st">&quot;login&quot;</span>),
      <span class="dt">name =</span> <span class="st">&quot;name&quot;</span>,
      <span class="dt">homepage =</span> <span class="st">&quot;homepage&quot;</span>,
      <span class="dt">watchers =</span> <span class="st">&quot;watchers_count&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>repo)
<span class="co">#&gt; # A tibble: 176 × 4</span>
<span class="co">#&gt;    login       name        homepage watchers</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;int&gt;</span>
<span class="co">#&gt;  1 gaborcsardi after        &lt;NA&gt;           5</span>
<span class="co">#&gt;  2 gaborcsardi argufy       &lt;NA&gt;          19</span>
<span class="co">#&gt;  3 gaborcsardi ask          &lt;NA&gt;           5</span>
<span class="co">#&gt;  4 gaborcsardi baseimports  &lt;NA&gt;           0</span>
<span class="co">#&gt;  5 gaborcsardi citest       &lt;NA&gt;           0</span>
<span class="co">#&gt;  6 gaborcsardi clisymbols  &quot;&quot;             18</span>
<span class="co">#&gt;  7 gaborcsardi cmaker       &lt;NA&gt;           0</span>
<span class="co">#&gt;  8 gaborcsardi cmark        &lt;NA&gt;           0</span>
<span class="co">#&gt;  9 gaborcsardi conditions   &lt;NA&gt;           0</span>
<span class="co">#&gt; 10 gaborcsardi crayon       &lt;NA&gt;          52</span>
<span class="co">#&gt; # … with 166 more rows</span></code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spec &lt;-<span class="st"> </span><span class="kw">s</span>(<span class="dt">stack =</span> <span class="ot">TRUE</span>,
          <span class="kw">s</span>(<span class="dt">stack =</span> <span class="ot">TRUE</span>,
            <span class="kw">s</span>(<span class="st">&quot;name&quot;</span>),
            <span class="kw">s</span>(<span class="st">&quot;homepage&quot;</span>),
            <span class="kw">s</span>(<span class="st">&quot;watchers_count&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;watchers&quot;</span>),
            <span class="kw">s</span>(<span class="st">&quot;owner&quot;</span>,
              <span class="kw">s</span>(<span class="st">&quot;login&quot;</span>))))
<span class="kw">unnest</span>(gh_repos, spec)
<span class="co">#&gt; # A tibble: 176 × 4</span>
<span class="co">#&gt;    homepage name        owner.login watchers</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;          &lt;int&gt;</span>
<span class="co">#&gt;  1  &lt;NA&gt;    after       gaborcsardi        5</span>
<span class="co">#&gt;  2  &lt;NA&gt;    argufy      gaborcsardi       19</span>
<span class="co">#&gt;  3  &lt;NA&gt;    ask         gaborcsardi        5</span>
<span class="co">#&gt;  4  &lt;NA&gt;    baseimports gaborcsardi        0</span>
<span class="co">#&gt;  5  &lt;NA&gt;    citest      gaborcsardi        0</span>
<span class="co">#&gt;  6 &quot;&quot;       clisymbols  gaborcsardi       18</span>
<span class="co">#&gt;  7  &lt;NA&gt;    cmaker      gaborcsardi        0</span>
<span class="co">#&gt;  8  &lt;NA&gt;    cmark       gaborcsardi        0</span>
<span class="co">#&gt;  9  &lt;NA&gt;    conditions  gaborcsardi        0</span>
<span class="co">#&gt; 10  &lt;NA&gt;    crayon      gaborcsardi       52</span>
<span class="co">#&gt; # … with 166 more rows</span></code></pre></div>
<p><a href="https://vspinu.github.io/unnest/">unnest</a> selectors (<code>s()</code>) apply to corresponding levels of the hierarchy and describe which elements should be selected and how. The <code>stack = TRUE</code> says that the result of the extraction should be stacked row-wise (aka <code>rbind</code>ed). <code>stack = FALSE</code>, means spread it across multiple columns (aka <code>cbind</code>ed). The <code>as</code> argument provides the name of the output. By default it's the entire path name to the selected leaf.</p>
<p>Now assume that you want the 3 components of &quot;repos&quot; and all components of the owner at once:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">repo =</span> gh_repos) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_longer</span>(repo) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">hoist</span>(repo,
        <span class="dt">name =</span> <span class="st">&quot;name&quot;</span>,
        <span class="dt">homepage =</span> <span class="st">&quot;homepage&quot;</span>,
        <span class="dt">watchers =</span> <span class="st">&quot;watchers_count&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">hoist</span>(repo, <span class="dt">owner =</span> <span class="st">&quot;owner&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_wider</span>(owner)</code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spec &lt;-<span class="st"> </span><span class="kw">s</span>(<span class="dt">stack =</span> <span class="ot">TRUE</span>,
          <span class="kw">s</span>(<span class="dt">stack =</span> <span class="ot">TRUE</span>,
            <span class="kw">s</span>(<span class="st">&quot;name&quot;</span>),
            <span class="kw">s</span>(<span class="st">&quot;homepage&quot;</span>),
            <span class="kw">s</span>(<span class="st">&quot;watchers_count&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;watchers&quot;</span>),
            <span class="kw">s</span>(<span class="st">&quot;owner&quot;</span>)))
<span class="kw">unnest</span>(gh_repos, spec) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tibble</span>()
<span class="co">#&gt; # A tibble: 176 × 20</span>
<span class="co">#&gt;    homepage name        owner.avatar_url   owner.events_url    owner.followers_…</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;              &lt;chr&gt;               &lt;chr&gt;            </span>
<span class="co">#&gt;  1  &lt;NA&gt;    after       https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt;  2  &lt;NA&gt;    argufy      https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt;  3  &lt;NA&gt;    ask         https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt;  4  &lt;NA&gt;    baseimports https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt;  5  &lt;NA&gt;    citest      https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt;  6 &quot;&quot;       clisymbols  https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt;  7  &lt;NA&gt;    cmaker      https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt;  8  &lt;NA&gt;    cmark       https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt;  9  &lt;NA&gt;    conditions  https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt; 10  &lt;NA&gt;    crayon      https://avatars.g… https://api.github… https://api.gith…</span>
<span class="co">#&gt; # … with 166 more rows, and 15 more variables: owner.following_url &lt;chr&gt;,</span>
<span class="co">#&gt; #   owner.gists_url &lt;chr&gt;, owner.gravatar_id &lt;chr&gt;, owner.html_url &lt;chr&gt;,</span>
<span class="co">#&gt; #   owner.id &lt;int&gt;, owner.login &lt;chr&gt;, owner.organizations_url &lt;chr&gt;,</span>
<span class="co">#&gt; #   owner.received_events_url &lt;chr&gt;, owner.repos_url &lt;chr&gt;,</span>
<span class="co">#&gt; #   owner.site_admin &lt;lgl&gt;, owner.starred_url &lt;chr&gt;,</span>
<span class="co">#&gt; #   owner.subscriptions_url &lt;chr&gt;, owner.type &lt;chr&gt;, owner.url &lt;chr&gt;,</span>
<span class="co">#&gt; #   watchers &lt;int&gt;</span></code></pre></div>
<p>Note that <a href="https://vspinu.github.io/unnest/">unnest</a> produces namespaced column names, while [tidyr'[s is not. This is a good thing as you don't have to worry about conflicting names. <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a> provides a &quot;fix&quot; for duplicated names in the form of <code>names_repair</code> argument to its functions.</p>
</div>
<div id="game-of-thrones-characters" class="section level2">
<h2>Game of Thrones characters</h2>
<p>What do you do with non-singleton leafs? Those are normally stacked, spread or melted depending on the analysis. For example the Game of Thrones dataset contains non-singleton leafs &quot;titles&quot;, &quot;aliases&quot;, &quot;books&quot; etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(got_chars[[<span class="dv">1</span>]])</code></pre></div>
<p>Let's have a look at some common scenarios.</p>
<div id="stacking" class="section level3">
<h3>Stacking</h3>
<p>Assume that we want a row for every book and TV series that the character appears in. That is, we want a long table with all combinations (aka cross product) of books and TV series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">char =</span> got_chars) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_wider</span>(char) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(name, books, tvSeries) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_longer</span>(books) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_longer</span>(tvSeries)
<span class="co">#&gt; # A tibble: 236 × 3</span>
<span class="co">#&gt;    name          books             tvSeries</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;             &lt;chr&gt;   </span>
<span class="co">#&gt;  1 Theon Greyjoy A Game of Thrones Season 1</span>
<span class="co">#&gt;  2 Theon Greyjoy A Game of Thrones Season 2</span>
<span class="co">#&gt;  3 Theon Greyjoy A Game of Thrones Season 3</span>
<span class="co">#&gt;  4 Theon Greyjoy A Game of Thrones Season 4</span>
<span class="co">#&gt;  5 Theon Greyjoy A Game of Thrones Season 5</span>
<span class="co">#&gt;  6 Theon Greyjoy A Game of Thrones Season 6</span>
<span class="co">#&gt;  7 Theon Greyjoy A Storm of Swords Season 1</span>
<span class="co">#&gt;  8 Theon Greyjoy A Storm of Swords Season 2</span>
<span class="co">#&gt;  9 Theon Greyjoy A Storm of Swords Season 3</span>
<span class="co">#&gt; 10 Theon Greyjoy A Storm of Swords Season 4</span>
<span class="co">#&gt; # … with 226 more rows</span>
<span class="kw">unnest</span>(got_chars,
       <span class="kw">s</span>(<span class="dt">stack =</span> T,
         <span class="kw">s</span>(<span class="st">&quot;name&quot;</span>),
         <span class="kw">s</span>(<span class="st">&quot;books,tvSeries/&quot;</span>, <span class="dt">stack =</span> T)))
<span class="co">#&gt; # A tibble: 236 × 3</span>
<span class="co">#&gt;    books             name          tvSeries</span>
<span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;         &lt;chr&gt;   </span>
<span class="co">#&gt;  1 A Game of Thrones Theon Greyjoy Season 1</span>
<span class="co">#&gt;  2 A Storm of Swords Theon Greyjoy Season 2</span>
<span class="co">#&gt;  3 A Feast for Crows Theon Greyjoy Season 3</span>
<span class="co">#&gt;  4 A Game of Thrones Theon Greyjoy Season 4</span>
<span class="co">#&gt;  5 A Storm of Swords Theon Greyjoy Season 5</span>
<span class="co">#&gt;  6 A Feast for Crows Theon Greyjoy Season 6</span>
<span class="co">#&gt;  7 A Game of Thrones Theon Greyjoy Season 1</span>
<span class="co">#&gt;  8 A Storm of Swords Theon Greyjoy Season 2</span>
<span class="co">#&gt;  9 A Feast for Crows Theon Greyjoy Season 3</span>
<span class="co">#&gt; 10 A Game of Thrones Theon Greyjoy Season 4</span>
<span class="co">#&gt; # … with 226 more rows</span></code></pre></div>
<p>Implementation aside, [tidyr'[s intermediary steps are generally costly for two reasons. First, because intermediary data.frames are created during the processing. Second, because intermediary objects might contain columns that are not needed in the subsequent processing. In the above examples <code>unnest_wider()</code> produced man more columns than we need. A better approach would be to replace it with a bit more verbose <code>hoist</code> call.</p>
<p>In contrast <a href="https://vspinu.github.io/unnest/">unnest</a> doesn't produce intermediary data structures. In fact, <a href="https://vspinu.github.io/unnest/">unnest</a> follows a 0-intermediary-copy semantics. The input vectors are directly copied into the output, no matter how complex the nesting is.</p>
<p>Cross-product is commonly useful when only one non-singleton variable is extracted. For example, let's match title to name:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">char =</span> got_chars) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">hoist</span>(char, <span class="dt">name =</span> <span class="st">&quot;name&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;titles&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>char) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_longer</span>(title)
<span class="co">#&gt; # A tibble: 60 × 2</span>
<span class="co">#&gt;    name              title                                                 </span>
<span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;                                                 </span>
<span class="co">#&gt;  1 Theon Greyjoy     &quot;Prince of Winterfell&quot;                                </span>
<span class="co">#&gt;  2 Theon Greyjoy     &quot;Captain of Sea Bitch&quot;                                </span>
<span class="co">#&gt;  3 Theon Greyjoy     &quot;Lord of the Iron Islands (by law of the green lands)&quot;</span>
<span class="co">#&gt;  4 Tyrion Lannister  &quot;Acting Hand of the King (former)&quot;                    </span>
<span class="co">#&gt;  5 Tyrion Lannister  &quot;Master of Coin (former)&quot;                             </span>
<span class="co">#&gt;  6 Victarion Greyjoy &quot;Lord Captain of the Iron Fleet&quot;                      </span>
<span class="co">#&gt;  7 Victarion Greyjoy &quot;Master of the Iron Victory&quot;                          </span>
<span class="co">#&gt;  8 Will              &quot;&quot;                                                    </span>
<span class="co">#&gt;  9 Areo Hotah        &quot;Captain of the Guard at Sunspear&quot;                    </span>
<span class="co">#&gt; 10 Chett             &quot;&quot;                                                    </span>
<span class="co">#&gt; # … with 50 more rows</span>
<span class="kw">unnest</span>(got_chars,
       <span class="kw">s</span>(<span class="dt">stack =</span> T,
         <span class="kw">s</span>(<span class="st">&quot;name&quot;</span>),
         <span class="kw">s</span>(<span class="st">&quot;titles/&quot;</span>, <span class="dt">stack =</span> T)))
<span class="co">#&gt; # A tibble: 60 × 2</span>
<span class="co">#&gt;    name              titles                                                </span>
<span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;                                                 </span>
<span class="co">#&gt;  1 Theon Greyjoy     &quot;Prince of Winterfell&quot;                                </span>
<span class="co">#&gt;  2 Theon Greyjoy     &quot;Captain of Sea Bitch&quot;                                </span>
<span class="co">#&gt;  3 Theon Greyjoy     &quot;Lord of the Iron Islands (by law of the green lands)&quot;</span>
<span class="co">#&gt;  4 Tyrion Lannister  &quot;Acting Hand of the King (former)&quot;                    </span>
<span class="co">#&gt;  5 Tyrion Lannister  &quot;Master of Coin (former)&quot;                             </span>
<span class="co">#&gt;  6 Victarion Greyjoy &quot;Lord Captain of the Iron Fleet&quot;                      </span>
<span class="co">#&gt;  7 Victarion Greyjoy &quot;Master of the Iron Victory&quot;                          </span>
<span class="co">#&gt;  8 Will              &quot;&quot;                                                    </span>
<span class="co">#&gt;  9 Areo Hotah        &quot;Captain of the Guard at Sunspear&quot;                    </span>
<span class="co">#&gt; 10 Chett             &quot;&quot;                                                    </span>
<span class="co">#&gt; # … with 50 more rows</span></code></pre></div>
</div>
<div id="id-value-long-tables-aka-long-pivoting-or-melting" class="section level3">
<h3>Id-value long tables (aka long pivoting, or melting)</h3>
<p>A common scenario is to stack the non-scalar leafs and replicate id labels in a separate &quot;key&quot; column. This is called &quot;melting&quot; (<code>reshape2</code>) or &quot;long pivoting&quot; (<code>tidyr</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">char =</span> got_chars) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_wider</span>(char) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(name, books, tvSeries) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">c</span>(books, tvSeries), <span class="dt">names_to =</span> <span class="st">&quot;media&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_longer</span>(value)

<span class="kw">unnest</span>(got_chars,
       <span class="kw">s</span>(<span class="dt">stack =</span> T,
         <span class="kw">s</span>(<span class="st">&quot;name&quot;</span>),
         <span class="kw">s</span>(<span class="st">&quot;books,tvSeries&quot;</span>, <span class="dt">stack =</span> <span class="st">&quot;media&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;value&quot;</span>,
           <span class="kw">s</span>(<span class="dt">stack =</span> T))))</code></pre></div>
</div>
<div id="id-value-wide-tables" class="section level3">
<h3>Id-value wide tables</h3>
<p>One might want to stack id vars (media) but spread the measures (books, tvSeries) horizontally such that each row would contain all measurement for each media.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># There seem not to be an easy way to achieve this with tidyr</span>

<span class="kw">unnest</span>(got_chars,
       <span class="kw">s</span>(<span class="dt">stack =</span> T,
         <span class="kw">s</span>(<span class="st">&quot;name&quot;</span>),
         <span class="kw">s</span>(<span class="st">&quot;books,tvSeries&quot;</span>, <span class="dt">stack =</span> <span class="st">&quot;media&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;value&quot;</span>)))</code></pre></div>
</div>
<div id="wide-tables-aka-spreading" class="section level3">
<h3>Wide Tables (aka spreading)</h3>
<p>This strategy is commonly used in machine learning scenarios when large sparse tables are plugged into black-box ML algorithms. This is the default behavior in <a href="https://vspinu.github.io/unnest/">unnest</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Currently tidyr errors on double widening due to name conflicts.</span>
<span class="co"># tibble(char = got_chars) %&gt;%</span>
<span class="co">#   unnest_wider(char) %&gt;%</span>
<span class="co">#   select(name, books, tvSeries) %&gt;%</span>
<span class="co">#   unnest_wider(books) %&gt;%</span>
<span class="co">#   unnest_wider(tvSeries)</span>

<span class="kw">unnest</span>(got_chars, <span class="kw">s</span>(<span class="dt">stack =</span> T, <span class="kw">s</span>(<span class="st">&quot;name, books, tvSeries&quot;</span>)))</code></pre></div>
</div>
</div>
<div id="sharla-gelfands-discography" class="section level2">
<h2>Sharla Gelfand's discography</h2>
<p>Finally, the most complex transformation from [tidyr'[s vignette can be achieved with unnest in a single step.</p>
<p>Typical entry of <code>disog</code> collection looks like this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(discog[[<span class="dv">3</span>]])
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ instance_id      : int 354091476</span>
<span class="co">#&gt;  $ date_added       : chr &quot;2019-02-13T14:07:23-08:00&quot;</span>
<span class="co">#&gt;  $ basic_information:List of 11</span>
<span class="co">#&gt;   ..$ labels      :List of 1</span>
<span class="co">#&gt;   .. ..$ :List of 6</span>
<span class="co">#&gt;   .. .. ..$ name            : chr &quot;La Vida Es Un Mus&quot;</span>
<span class="co">#&gt;   .. .. ..$ entity_type     : chr &quot;1&quot;</span>
<span class="co">#&gt;   .. .. ..$ catno           : chr &quot;MUS118&quot;</span>
<span class="co">#&gt;   .. .. ..$ resource_url    : chr &quot;https://api.discogs.com/labels/38322&quot;</span>
<span class="co">#&gt;   .. .. ..$ id              : int 38322</span>
<span class="co">#&gt;   .. .. ..$ entity_type_name: chr &quot;Label&quot;</span>
<span class="co">#&gt;   ..$ year        : int 2017</span>
<span class="co">#&gt;   ..$ master_url  : chr &quot;https://api.discogs.com/masters/1109943&quot;</span>
<span class="co">#&gt;   ..$ artists     :List of 1</span>
<span class="co">#&gt;   .. ..$ :List of 7</span>
<span class="co">#&gt;   .. .. ..$ join        : chr &quot;&quot;</span>
<span class="co">#&gt;   .. .. ..$ name        : chr &quot;S.H.I.T. (3)&quot;</span>
<span class="co">#&gt;   .. .. ..$ anv         : chr &quot;&quot;</span>
<span class="co">#&gt;   .. .. ..$ tracks      : chr &quot;&quot;</span>
<span class="co">#&gt;   .. .. ..$ role        : chr &quot;&quot;</span>
<span class="co">#&gt;   .. .. ..$ resource_url: chr &quot;https://api.discogs.com/artists/2769828&quot;</span>
<span class="co">#&gt;   .. .. ..$ id          : int 2769828</span>
<span class="co">#&gt;   ..$ id          : int 9827276</span>
<span class="co">#&gt;   ..$ thumb       : chr &quot;https://img.discogs.com/x6GUri3hXAcfzF2wz5jQloomOoY=/fit-in/150x150/filters:strip_icc():format(jpeg):mode_rgb()&quot;| __truncated__</span>
<span class="co">#&gt;   ..$ title       : chr &quot;I&quot;</span>
<span class="co">#&gt;   ..$ formats     :List of 1</span>
<span class="co">#&gt;   .. ..$ :List of 3</span>
<span class="co">#&gt;   .. .. ..$ descriptions:List of 3</span>
<span class="co">#&gt;   .. .. .. ..$ : chr &quot;7\&quot;&quot;</span>
<span class="co">#&gt;   .. .. .. ..$ : chr &quot;45 RPM&quot;</span>
<span class="co">#&gt;   .. .. .. ..$ : chr &quot;EP&quot;</span>
<span class="co">#&gt;   .. .. ..$ name        : chr &quot;Vinyl&quot;</span>
<span class="co">#&gt;   .. .. ..$ qty         : chr &quot;1&quot;</span>
<span class="co">#&gt;   ..$ cover_image : chr &quot;https://img.discogs.com/7aJPlo2phtFL-T2Kt6MTBc0uftY=/fit-in/600x600/filters:strip_icc():format(jpeg):mode_rgb()&quot;| __truncated__</span>
<span class="co">#&gt;   ..$ resource_url: chr &quot;https://api.discogs.com/releases/9827276&quot;</span>
<span class="co">#&gt;   ..$ master_id   : int 1109943</span>
<span class="co">#&gt;  $ id               : int 9827276</span>
<span class="co">#&gt;  $ rating           : int 0</span></code></pre></div>
<p>We want to extract <code>artists</code> metadata and <code>formats</code> into separate tables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">disc =</span> discog) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_wider</span>(disc) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">hoist</span>(basic_information, <span class="dt">artist =</span> <span class="st">&quot;artists&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">disc_id =</span> id, artist) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_longer</span>(artist) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_wider</span>(artist)
<span class="co">#&gt; # A tibble: 167 × 8</span>
<span class="co">#&gt;     disc_id join  name                     anv   tracks role  resource_url     id</span>
<span class="co">#&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;                    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;         &lt;int&gt;</span>
<span class="co">#&gt;  1  7496378 &quot;&quot;    Mollot                   &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 4.62e6</span>
<span class="co">#&gt;  2  4490852 &quot;&quot;    Una Bèstia Incontrolable &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 3.19e6</span>
<span class="co">#&gt;  3  9827276 &quot;&quot;    S.H.I.T. (3)             &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 2.77e6</span>
<span class="co">#&gt;  4  9769203 &quot;&quot;    Rata Negra               &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 4.28e6</span>
<span class="co">#&gt;  5  7237138 &quot;&quot;    Ivy (18)                 &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 3.60e6</span>
<span class="co">#&gt;  6 13117042 &quot;&quot;    Tashme                   &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 5.21e6</span>
<span class="co">#&gt;  7  7113575 &quot;&quot;    Desgraciados             &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 4.45e6</span>
<span class="co">#&gt;  8 10540713 &quot;&quot;    Phantom Head             &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 4.27e6</span>
<span class="co">#&gt;  9 11260950 &quot;&quot;    Sub Space (2)            &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 5.69e6</span>
<span class="co">#&gt; 10 11726853 &quot;&quot;    Small Man (2)            &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 6.37e6</span>
<span class="co">#&gt; # … with 157 more rows</span>
<span class="kw">tibble</span>(<span class="dt">disc =</span> discog) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_wider</span>(disc) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">hoist</span>(basic_information, <span class="dt">format =</span> <span class="st">&quot;formats&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">disc_id =</span> id, format) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_longer</span>(format) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_wider</span>(format) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_longer</span>(descriptions)
<span class="co">#&gt; # A tibble: 281 × 5</span>
<span class="co">#&gt;     disc_id descriptions text  name     qty  </span>
<span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;</span>
<span class="co">#&gt;  1  7496378 &quot;Numbered&quot;   Black Cassette 1    </span>
<span class="co">#&gt;  2  4490852 &quot;LP&quot;         &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt;  3  9827276 &quot;7\&quot;&quot;        &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt;  4  9827276 &quot;45 RPM&quot;     &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt;  5  9827276 &quot;EP&quot;         &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt;  6  9769203 &quot;LP&quot;         &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt;  7  9769203 &quot;Album&quot;      &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt;  8  7237138 &quot;7\&quot;&quot;        &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt;  9  7237138 &quot;45 RPM&quot;     &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt; 10 13117042 &quot;7\&quot;&quot;        &lt;NA&gt;  Vinyl    1    </span>
<span class="co">#&gt; # … with 271 more rows</span></code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a> you can achieve this in two separate passes through the list, or in a single pass with a grouped children specification. The single pass extraction returns a list of data.frames, but scans the data only once.</p>
<p>Separate unnest calls:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unnest</span>(discog,
       <span class="kw">s</span>(<span class="dt">stack =</span> T,
         <span class="kw">s</span>(<span class="st">&quot;id&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;disc_id&quot;</span>),
         <span class="kw">s</span>(<span class="st">&quot;basic_information/artists&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;artist&quot;</span>,
           <span class="kw">s</span>(<span class="dt">stack =</span> T))))

<span class="kw">unnest</span>(discog,
       <span class="kw">s</span>(<span class="dt">stack =</span> T,
         <span class="kw">s</span>(<span class="st">&quot;id&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;disc_id&quot;</span>),
         <span class="kw">s</span>(<span class="st">&quot;basic_information/formats&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;format&quot;</span>,
           <span class="kw">s</span>(<span class="dt">stack =</span> T,
             <span class="kw">s</span>(<span class="dt">exclude =</span> <span class="st">&quot;descriptions&quot;</span>),
             <span class="kw">s</span>(<span class="st">&quot;descriptions/&quot;</span>, <span class="dt">stack =</span> T)))))</code></pre></div>
<p>Single unnest pass:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unnest</span>(discog,
       <span class="kw">s</span>(<span class="dt">stack =</span> T,
         <span class="dt">groups =</span>
           <span class="kw">list</span>(<span class="dt">artists =</span>
                  <span class="kw">list</span>(<span class="kw">s</span>(<span class="st">&quot;id&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;disc_id&quot;</span>),
                       <span class="kw">s</span>(<span class="st">&quot;basic_information/artists&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;artist&quot;</span>,
                         <span class="kw">s</span>(<span class="dt">stack =</span> T))),
                <span class="dt">formats =</span>
                  <span class="kw">list</span>(<span class="kw">s</span>(<span class="st">&quot;id&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;disc_id&quot;</span>),
                       <span class="kw">s</span>(<span class="st">&quot;basic_information/formats&quot;</span>, <span class="dt">as =</span> <span class="st">&quot;format&quot;</span>,
                         <span class="kw">s</span>(<span class="dt">stack =</span> T,
                           <span class="kw">s</span>(<span class="dt">exclude =</span> <span class="st">&quot;descriptions&quot;</span>),
                           <span class="kw">s</span>(<span class="st">&quot;descriptions/&quot;</span>, <span class="dt">stack =</span> T)))))))</code></pre></div>
<p>The unnest specs inside <code>groups</code> is the same as in the separate-calls case. The <code>groups</code> argument is just like <code>children</code> argument with the difference that the output of the extraction is not cross-joined, but simply returned as list.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>The benefit is grouped extraction is twofold. First, it's faster because the list is traversed only once. Second, the de-duplication works across groups. That is, when <code>dedupe = TRUE</code> (not shown in the above examples), the fields extracted by the preceding specs are not extracted by the specs that follow.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Currently <code>groups</code> argument works only with the top level of the unnest specification.<a href="#fnref1">↩</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
