<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Compare with Tidyr’s Rectangling</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Compare with Tidyr’s Rectangling</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>As per <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a>
definition unnesting (or rectangling):</p>
<pre><code> ... is the art and craft of taking a deeply nested list (often sourced
 from wild caught JSON or XML) and taming it into a tidy data set of rows and
 columns. There are three functions from tidyr that are particularly useful for
 rectangling:</code></pre>
<p><a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a>
core functions for unnesting are <code>unnest_longer()</code>,
<code>unnest_wider()</code>, <code>hoist()</code>. This guide follows
the steps from <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a>
vignette and translates them into <code>unnest</code>’s language.</p>
<p>With <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a> you
have to unnest lists in several steps by using one of the three core
functions. With <code>unnest</code> you do all at once in one step.
<code>unnest</code> doesn’t produce intermediate list columns.</p>
<p>We’ll use the <code>repurrrsive</code> package as the source of our
nested lists:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">library</span>(repurrrsive)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">library</span>(unnest)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">options</span>(<span class="at">unnest.return.type =</span> <span class="st">&quot;tibble&quot;</span>)</span></code></pre></div>
</div>
<div id="github-repos" class="section level2">
<h2>GitHub repos</h2>
<p>With <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a> you
start by putting a list into a data.frame column. With <a href="https://vspinu.github.io/unnest/">unnest</a> this is not
necessary.</p>
<p><code>gh_repos</code> is a nested list with maximal depth of 4
“user”&gt;“repo”&gt;“owner”&gt;“[xyz]”.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">str</span>(gh_repos[[<span class="dv">1</span>]][[<span class="dv">1</span>]][[<span class="st">&quot;owner&quot;</span>]])</span></code></pre></div>
<p>Let’s say that we want a <code>data.frame</code> with 3 columns,
“name”, “homepage” and “watchers_count”, from level 3 of repo
characteristics and one,“login”, from level 4 of owner characteristics.
This is how it’s done with <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>repos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">repo =</span> gh_repos)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>repos <span class="ot">&lt;-</span> <span class="fu">unnest_longer</span>(repos, repo)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">hoist</span>(repos, repo,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>      <span class="at">login =</span> <span class="fu">c</span>(<span class="st">&quot;owner&quot;</span>, <span class="st">&quot;login&quot;</span>),</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>      <span class="at">homepage =</span> <span class="st">&quot;homepage&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>      <span class="at">watchers =</span> <span class="st">&quot;watchers_count&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>repo)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; # A tibble: 176 × 4</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;    login       name        homepage watchers</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;int&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt;  1 gaborcsardi after       &lt;NA&gt;            5</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt;  2 gaborcsardi argufy      &lt;NA&gt;           19</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt;  3 gaborcsardi ask         &lt;NA&gt;            5</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt;  4 gaborcsardi baseimports &lt;NA&gt;            0</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt;  5 gaborcsardi citest      &lt;NA&gt;            0</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt;  6 gaborcsardi clisymbols  &quot;&quot;             18</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt;  7 gaborcsardi cmaker      &lt;NA&gt;            0</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt;  8 gaborcsardi cmark       &lt;NA&gt;            0</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt;  9 gaborcsardi conditions  &lt;NA&gt;            0</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; 10 gaborcsardi crayon      &lt;NA&gt;           52</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; # ℹ 166 more rows</span></span></code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">s</span>(<span class="at">stack =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>          <span class="fu">s</span>(<span class="at">stack =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>            <span class="fu">s</span>(<span class="st">&quot;name&quot;</span>),</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>            <span class="fu">s</span>(<span class="st">&quot;homepage&quot;</span>),</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>            <span class="fu">s</span>(<span class="st">&quot;watchers_count&quot;</span>, <span class="at">as =</span> <span class="st">&quot;watchers&quot;</span>),</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>            <span class="fu">s</span>(<span class="st">&quot;owner&quot;</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>              <span class="fu">s</span>(<span class="st">&quot;login&quot;</span>))))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="fu">unnest</span>(gh_repos, spec)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; # A tibble: 176 × 4</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt;    homepage name        owner.login watchers</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;          &lt;int&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt;  1 &lt;NA&gt;     after       gaborcsardi        5</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt;  2 &lt;NA&gt;     argufy      gaborcsardi       19</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt;  3 &lt;NA&gt;     ask         gaborcsardi        5</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt;  4 &lt;NA&gt;     baseimports gaborcsardi        0</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt;  5 &lt;NA&gt;     citest      gaborcsardi        0</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt;  6 &quot;&quot;       clisymbols  gaborcsardi       18</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt;  7 &lt;NA&gt;     cmaker      gaborcsardi        0</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt;  8 &lt;NA&gt;     cmark       gaborcsardi        0</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt;  9 &lt;NA&gt;     conditions  gaborcsardi        0</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; 10 &lt;NA&gt;     crayon      gaborcsardi       52</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt; # ℹ 166 more rows</span></span></code></pre></div>
<p><a href="https://vspinu.github.io/unnest/">unnest</a> selectors
(<code>s()</code>) apply to corresponding levels of the hierarchy and
describe which elements should be selected and how. The
<code>stack = TRUE</code> says that the result of the extraction should
be stacked row-wise (aka <code>rbind</code>ed).
<code>stack = FALSE</code>, means spread it across multiple columns (aka
<code>cbind</code>ed). The <code>as</code> argument provides the name of
the output. By default it’s the entire path name to the selected
leaf.</p>
<p>Now assume that you want the 3 components of “repos” and all
components of the owner at once:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">repo =</span> gh_repos) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(repo) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">hoist</span>(repo,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>        <span class="at">homepage =</span> <span class="st">&quot;homepage&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>        <span class="at">watchers =</span> <span class="st">&quot;watchers_count&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="fu">hoist</span>(repo, <span class="at">owner =</span> <span class="st">&quot;owner&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(owner)</span></code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">s</span>(<span class="at">stack =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>          <span class="fu">s</span>(<span class="at">stack =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>            <span class="fu">s</span>(<span class="st">&quot;name&quot;</span>),</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>            <span class="fu">s</span>(<span class="st">&quot;homepage&quot;</span>),</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>            <span class="fu">s</span>(<span class="st">&quot;watchers_count&quot;</span>, <span class="at">as =</span> <span class="st">&quot;watchers&quot;</span>),</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>            <span class="fu">s</span>(<span class="st">&quot;owner&quot;</span>)))</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="fu">unnest</span>(gh_repos, spec) <span class="sc">%&gt;%</span> <span class="fu">tibble</span>()</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; # A tibble: 176 × 20</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt;    homepage name        owner.avatar_url    owner.events_url owner.followers_url</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;               &lt;chr&gt;            &lt;chr&gt;              </span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt;  1 &lt;NA&gt;     after       https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt;  2 &lt;NA&gt;     argufy      https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;  3 &lt;NA&gt;     ask         https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt;  4 &lt;NA&gt;     baseimports https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt;  5 &lt;NA&gt;     citest      https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt;  6 &quot;&quot;       clisymbols  https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt;  7 &lt;NA&gt;     cmaker      https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt;  8 &lt;NA&gt;     cmark       https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt;  9 &lt;NA&gt;     conditions  https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; 10 &lt;NA&gt;     crayon      https://avatars.gi… https://api.git… https://api.github…</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; # ℹ 166 more rows</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; # ℹ 15 more variables: owner.following_url &lt;chr&gt;, owner.gists_url &lt;chr&gt;,</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; #   owner.gravatar_id &lt;chr&gt;, owner.html_url &lt;chr&gt;, owner.id &lt;int&gt;,</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt; #   owner.login &lt;chr&gt;, owner.organizations_url &lt;chr&gt;,</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt; #   owner.received_events_url &lt;chr&gt;, owner.repos_url &lt;chr&gt;,</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt; #   owner.site_admin &lt;lgl&gt;, owner.starred_url &lt;chr&gt;,</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co">#&gt; #   owner.subscriptions_url &lt;chr&gt;, owner.type &lt;chr&gt;, owner.url &lt;chr&gt;, …</span></span></code></pre></div>
<p>Note that <a href="https://vspinu.github.io/unnest/">unnest</a>
produces namespaced column names, while [tidyr’[s is not. This is a good
thing as you don’t have to worry about conflicting names. <a href="https://tidyr.tidyverse.org/articles/rectangle.html">tidyr</a>
provides a “fix” for duplicated names in the form of
<code>names_repair</code> argument to its functions.</p>
</div>
<div id="game-of-thrones-characters" class="section level2">
<h2>Game of Thrones characters</h2>
<p>What do you do with non-singleton leafs? Those are normally stacked,
spread or melted depending on the analysis. For example the Game of
Thrones dataset contains non-singleton leafs “titles”, “aliases”,
“books” etc.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">str</span>(got_chars[[<span class="dv">1</span>]])</span></code></pre></div>
<p>Let’s have a look at some common scenarios.</p>
<div id="stacking" class="section level3">
<h3>Stacking</h3>
<p>Assume that we want a row for every book and TV series that the
character appears in. That is, we want a long table with all
combinations (aka cross product) of books and TV series.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">char =</span> got_chars) <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(char) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">select</span>(name, books, tvSeries) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(books) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(tvSeries)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; # A tibble: 230 × 3</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt;    name          books             tvSeries</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;             &lt;chr&gt;   </span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;  1 Theon Greyjoy A Game of Thrones Season 1</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt;  2 Theon Greyjoy A Game of Thrones Season 2</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt;  3 Theon Greyjoy A Game of Thrones Season 3</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt;  4 Theon Greyjoy A Game of Thrones Season 4</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;  5 Theon Greyjoy A Game of Thrones Season 5</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;  6 Theon Greyjoy A Game of Thrones Season 6</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt;  7 Theon Greyjoy A Storm of Swords Season 1</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt;  8 Theon Greyjoy A Storm of Swords Season 2</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt;  9 Theon Greyjoy A Storm of Swords Season 3</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt; 10 Theon Greyjoy A Storm of Swords Season 4</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt; # ℹ 220 more rows</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="fu">unnest</span>(got_chars,</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>       <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;name&quot;</span>),</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;books,tvSeries/&quot;</span>, <span class="at">stack =</span> T)))</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#&gt; # A tibble: 236 × 3</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#&gt;    books             name          tvSeries</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;         &lt;chr&gt;   </span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#&gt;  1 A Game of Thrones Theon Greyjoy Season 1</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#&gt;  2 A Storm of Swords Theon Greyjoy Season 2</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#&gt;  3 A Feast for Crows Theon Greyjoy Season 3</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt;  4 A Game of Thrones Theon Greyjoy Season 4</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#&gt;  5 A Storm of Swords Theon Greyjoy Season 5</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#&gt;  6 A Feast for Crows Theon Greyjoy Season 6</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#&gt;  7 A Game of Thrones Theon Greyjoy Season 1</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#&gt;  8 A Storm of Swords Theon Greyjoy Season 2</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co">#&gt;  9 A Feast for Crows Theon Greyjoy Season 3</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a><span class="co">#&gt; 10 A Game of Thrones Theon Greyjoy Season 4</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="co">#&gt; # ℹ 226 more rows</span></span></code></pre></div>
<p>Implementation aside, [tidyr’[s intermediary steps are generally
costly for two reasons. First, because intermediary data.frames are
created during the processing. Second, because intermediary objects
might contain columns that are not needed in the subsequent processing.
In the above examples <code>unnest_wider()</code> produced man more
columns than we need. A better approach would be to replace it with a
bit more verbose <code>hoist</code> call.</p>
<p>In contrast <a href="https://vspinu.github.io/unnest/">unnest</a>
doesn’t produce intermediary data structures. In fact, <a href="https://vspinu.github.io/unnest/">unnest</a> follows a
0-intermediary-copy semantics. The input vectors are directly copied
into the output, no matter how complex the nesting is.</p>
<p>Cross-product is commonly useful when only one non-singleton variable
is extracted. For example, let’s match title to name:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">char =</span> got_chars) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">hoist</span>(char, <span class="at">name =</span> <span class="st">&quot;name&quot;</span>, <span class="at">title =</span> <span class="st">&quot;titles&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>char) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(title)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 59 × 2</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt;    name              title                                                 </span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;                                                 </span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt;  1 Theon Greyjoy     &quot;Prince of Winterfell&quot;                                </span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt;  2 Theon Greyjoy     &quot;Lord of the Iron Islands (by law of the green lands)&quot;</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;  3 Tyrion Lannister  &quot;Acting Hand of the King (former)&quot;                    </span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;  4 Tyrion Lannister  &quot;Master of Coin (former)&quot;                             </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt;  5 Victarion Greyjoy &quot;Lord Captain of the Iron Fleet&quot;                      </span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;  6 Victarion Greyjoy &quot;Master of the Iron Victory&quot;                          </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt;  7 Will              &quot;&quot;                                                    </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt;  8 Areo Hotah        &quot;Captain of the Guard at Sunspear&quot;                    </span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt;  9 Chett             &quot;&quot;                                                    </span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; 10 Cressen           &quot;Maester&quot;                                             </span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; # ℹ 49 more rows</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="fu">unnest</span>(got_chars,</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>       <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;name&quot;</span>),</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;titles/&quot;</span>, <span class="at">stack =</span> T)))</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co">#&gt; # A tibble: 59 × 2</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co">#&gt;    name              titles                                                </span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;                                                 </span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#&gt;  1 Theon Greyjoy     &quot;Prince of Winterfell&quot;                                </span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="co">#&gt;  2 Theon Greyjoy     &quot;Lord of the Iron Islands (by law of the green lands)&quot;</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a><span class="co">#&gt;  3 Tyrion Lannister  &quot;Acting Hand of the King (former)&quot;                    </span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a><span class="co">#&gt;  4 Tyrion Lannister  &quot;Master of Coin (former)&quot;                             </span></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a><span class="co">#&gt;  5 Victarion Greyjoy &quot;Lord Captain of the Iron Fleet&quot;                      </span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="co">#&gt;  6 Victarion Greyjoy &quot;Master of the Iron Victory&quot;                          </span></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a><span class="co">#&gt;  7 Will              &quot;&quot;                                                    </span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="co">#&gt;  8 Areo Hotah        &quot;Captain of the Guard at Sunspear&quot;                    </span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a><span class="co">#&gt;  9 Chett             &quot;&quot;                                                    </span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co">#&gt; 10 Cressen           &quot;Maester&quot;                                             </span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a><span class="co">#&gt; # ℹ 49 more rows</span></span></code></pre></div>
</div>
<div id="id-value-long-tables-aka-long-pivoting-or-melting" class="section level3">
<h3>Id-value long tables (aka long pivoting, or melting)</h3>
<p>A common scenario is to stack the non-scalar leafs and replicate id
labels in a separate “key” column. This is called “melting”
(<code>reshape2</code>) or “long pivoting” (<code>tidyr</code>).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">char =</span> got_chars) <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(char) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">select</span>(name, books, tvSeries) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(books, tvSeries), <span class="at">names_to =</span> <span class="st">&quot;media&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(value)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="fu">unnest</span>(got_chars,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>       <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;name&quot;</span>),</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;books,tvSeries&quot;</span>, <span class="at">stack =</span> <span class="st">&quot;media&quot;</span>, <span class="at">as =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>           <span class="fu">s</span>(<span class="at">stack =</span> T))))</span></code></pre></div>
</div>
<div id="id-value-wide-tables" class="section level3">
<h3>Id-value wide tables</h3>
<p>One might want to stack id vars (media) but spread the measures
(books, tvSeries) horizontally such that each row would contain all
measurement for each media.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># There seem not to be an easy way to achieve this with tidyr</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">unnest</span>(got_chars,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>       <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;name&quot;</span>),</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;books,tvSeries&quot;</span>, <span class="at">stack =</span> <span class="st">&quot;media&quot;</span>, <span class="at">as =</span> <span class="st">&quot;value&quot;</span>)))</span></code></pre></div>
</div>
<div id="wide-tables-aka-spreading" class="section level3">
<h3>Wide Tables (aka spreading)</h3>
<p>This strategy is commonly used in machine learning scenarios when
large sparse tables are plugged into black-box ML algorithms. This is
the default behavior in <a href="https://vspinu.github.io/unnest/">unnest</a>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Currently tidyr errors on double widening due to name conflicts.</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co"># tibble(char = got_chars) %&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#   unnest_wider(char) %&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#   select(name, books, tvSeries) %&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#   unnest_wider(books) %&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#   unnest_wider(tvSeries)</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">unnest</span>(got_chars, <span class="fu">s</span>(<span class="at">stack =</span> T, <span class="fu">s</span>(<span class="st">&quot;name, books, tvSeries&quot;</span>)))</span></code></pre></div>
</div>
</div>
<div id="sharla-gelfands-discography" class="section level2">
<h2>Sharla Gelfand’s discography</h2>
<p>Finally, the most complex transformation from [tidyr’[s vignette can
be achieved with unnest in a single step.</p>
<p>Typical entry of <code>disog</code> collection looks like this</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">str</span>(discog[[<span class="dv">3</span>]])</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; List of 5</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt;  $ instance_id      : int 354091476</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt;  $ date_added       : chr &quot;2019-02-13T14:07:23-08:00&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt;  $ basic_information:List of 11</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt;   ..$ labels      :List of 1</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt;   .. ..$ :List of 6</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ name            : chr &quot;La Vida Es Un Mus&quot;</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ entity_type     : chr &quot;1&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ catno           : chr &quot;MUS118&quot;</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ resource_url    : chr &quot;https://api.discogs.com/labels/38322&quot;</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ id              : int 38322</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ entity_type_name: chr &quot;Label&quot;</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt;   ..$ year        : int 2017</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt;   ..$ master_url  : chr &quot;https://api.discogs.com/masters/1109943&quot;</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt;   ..$ artists     :List of 1</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt;   .. ..$ :List of 7</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ join        : chr &quot;&quot;</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ name        : chr &quot;S.H.I.T. (3)&quot;</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ anv         : chr &quot;&quot;</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ tracks      : chr &quot;&quot;</span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ role        : chr &quot;&quot;</span></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ resource_url: chr &quot;https://api.discogs.com/artists/2769828&quot;</span></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ id          : int 2769828</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a><span class="co">#&gt;   ..$ id          : int 9827276</span></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a><span class="co">#&gt;   ..$ thumb       : chr &quot;https://img.discogs.com/x6GUri3hXAcfzF2wz5jQloomOoY=/fit-in/150x150/filters:strip_icc():format(jpeg):mode_rgb()&quot;| __truncated__</span></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a><span class="co">#&gt;   ..$ title       : chr &quot;I&quot;</span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a><span class="co">#&gt;   ..$ formats     :List of 1</span></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a><span class="co">#&gt;   .. ..$ :List of 3</span></span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ descriptions:List of 3</span></span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a><span class="co">#&gt;   .. .. .. ..$ : chr &quot;7\&quot;&quot;</span></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a><span class="co">#&gt;   .. .. .. ..$ : chr &quot;45 RPM&quot;</span></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a><span class="co">#&gt;   .. .. .. ..$ : chr &quot;EP&quot;</span></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ name        : chr &quot;Vinyl&quot;</span></span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a><span class="co">#&gt;   .. .. ..$ qty         : chr &quot;1&quot;</span></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a><span class="co">#&gt;   ..$ cover_image : chr &quot;https://img.discogs.com/7aJPlo2phtFL-T2Kt6MTBc0uftY=/fit-in/600x600/filters:strip_icc():format(jpeg):mode_rgb()&quot;| __truncated__</span></span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a><span class="co">#&gt;   ..$ resource_url: chr &quot;https://api.discogs.com/releases/9827276&quot;</span></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a><span class="co">#&gt;   ..$ master_id   : int 1109943</span></span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a><span class="co">#&gt;  $ id               : int 9827276</span></span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a><span class="co">#&gt;  $ rating           : int 0</span></span></code></pre></div>
<p>We want to extract <code>artists</code> metadata and
<code>formats</code> into separate tables.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">disc =</span> discog) <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(disc) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="fu">hoist</span>(basic_information, <span class="at">artist =</span> <span class="st">&quot;artists&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">disc_id =</span> id, artist) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(artist) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(artist)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; # A tibble: 167 × 8</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt;     disc_id join  name                    anv   tracks role  resource_url     id</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;         &lt;int&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt;  1  7496378 &quot;&quot;    Mollot                  &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 4.62e6</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt;  2  4490852 &quot;&quot;    Una Bèstia Incontrolab… &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 3.19e6</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt;  3  9827276 &quot;&quot;    S.H.I.T. (3)            &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 2.77e6</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt;  4  9769203 &quot;&quot;    Rata Negra              &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 4.28e6</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt;  5  7237138 &quot;&quot;    Ivy (18)                &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 3.60e6</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt;  6 13117042 &quot;&quot;    Tashme                  &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 5.21e6</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt;  7  7113575 &quot;&quot;    Desgraciados            &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 4.45e6</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt;  8 10540713 &quot;&quot;    Phantom Head            &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 4.27e6</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt;  9 11260950 &quot;&quot;    Sub Space (2)           &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 5.69e6</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt; 10 11726853 &quot;&quot;    Small Man (2)           &quot;&quot;    &quot;&quot;     &quot;&quot;    https://api… 6.37e6</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt; # ℹ 157 more rows</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">disc =</span> discog) <span class="sc">%&gt;%</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(disc) <span class="sc">%&gt;%</span></span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>  <span class="fu">hoist</span>(basic_information, <span class="at">format =</span> <span class="st">&quot;formats&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">disc_id =</span> id, format) <span class="sc">%&gt;%</span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(format) <span class="sc">%&gt;%</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(format) <span class="sc">%&gt;%</span></span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(descriptions)</span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a><span class="co">#&gt; # A tibble: 258 × 5</span></span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a><span class="co">#&gt;     disc_id descriptions text  name     qty  </span></span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a><span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;</span></span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a><span class="co">#&gt;  1  7496378 &quot;Numbered&quot;   Black Cassette 1    </span></span>
<span id="cb15-33"><a href="#cb15-33" tabindex="-1"></a><span class="co">#&gt;  2  4490852 &quot;LP&quot;         &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-34"><a href="#cb15-34" tabindex="-1"></a><span class="co">#&gt;  3  9827276 &quot;7\&quot;&quot;        &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-35"><a href="#cb15-35" tabindex="-1"></a><span class="co">#&gt;  4  9827276 &quot;45 RPM&quot;     &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-36"><a href="#cb15-36" tabindex="-1"></a><span class="co">#&gt;  5  9827276 &quot;EP&quot;         &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-37"><a href="#cb15-37" tabindex="-1"></a><span class="co">#&gt;  6  9769203 &quot;LP&quot;         &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-38"><a href="#cb15-38" tabindex="-1"></a><span class="co">#&gt;  7  9769203 &quot;Album&quot;      &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-39"><a href="#cb15-39" tabindex="-1"></a><span class="co">#&gt;  8  7237138 &quot;7\&quot;&quot;        &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-40"><a href="#cb15-40" tabindex="-1"></a><span class="co">#&gt;  9  7237138 &quot;45 RPM&quot;     &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-41"><a href="#cb15-41" tabindex="-1"></a><span class="co">#&gt; 10 13117042 &quot;7\&quot;&quot;        &lt;NA&gt;  Vinyl    1    </span></span>
<span id="cb15-42"><a href="#cb15-42" tabindex="-1"></a><span class="co">#&gt; # ℹ 248 more rows</span></span></code></pre></div>
<p>With <a href="https://vspinu.github.io/unnest/">unnest</a> you can
achieve this in two separate passes through the list, or in a single
pass with a grouped children specification. The single pass extraction
returns a list of data.frames, but scans the data only once.</p>
<p>Separate unnest calls:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">unnest</span>(discog,</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>       <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;id&quot;</span>, <span class="at">as =</span> <span class="st">&quot;disc_id&quot;</span>),</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;basic_information/artists&quot;</span>, <span class="at">as =</span> <span class="st">&quot;artist&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>           <span class="fu">s</span>(<span class="at">stack =</span> T))))</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="fu">unnest</span>(discog,</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>       <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;id&quot;</span>, <span class="at">as =</span> <span class="st">&quot;disc_id&quot;</span>),</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>         <span class="fu">s</span>(<span class="st">&quot;basic_information/formats&quot;</span>, <span class="at">as =</span> <span class="st">&quot;format&quot;</span>,</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>           <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>             <span class="fu">s</span>(<span class="at">exclude =</span> <span class="st">&quot;descriptions&quot;</span>),</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>             <span class="fu">s</span>(<span class="st">&quot;descriptions/&quot;</span>, <span class="at">stack =</span> T)))))</span></code></pre></div>
<p>Single unnest pass:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">unnest</span>(discog,</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>       <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>         <span class="at">groups =</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>           <span class="fu">list</span>(<span class="at">artists =</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="fu">s</span>(<span class="st">&quot;id&quot;</span>, <span class="at">as =</span> <span class="st">&quot;disc_id&quot;</span>),</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>                       <span class="fu">s</span>(<span class="st">&quot;basic_information/artists&quot;</span>, <span class="at">as =</span> <span class="st">&quot;artist&quot;</span>,</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>                         <span class="fu">s</span>(<span class="at">stack =</span> T))),</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>                <span class="at">formats =</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="fu">s</span>(<span class="st">&quot;id&quot;</span>, <span class="at">as =</span> <span class="st">&quot;disc_id&quot;</span>),</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>                       <span class="fu">s</span>(<span class="st">&quot;basic_information/formats&quot;</span>, <span class="at">as =</span> <span class="st">&quot;format&quot;</span>,</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>                         <span class="fu">s</span>(<span class="at">stack =</span> T,</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>                           <span class="fu">s</span>(<span class="at">exclude =</span> <span class="st">&quot;descriptions&quot;</span>),</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>                           <span class="fu">s</span>(<span class="st">&quot;descriptions/&quot;</span>, <span class="at">stack =</span> T)))))))</span></code></pre></div>
<p>The unnest specs inside <code>groups</code> is the same as in the
separate-calls case. The <code>groups</code> argument is just like
<code>children</code> argument with the difference that the output of
the extraction is not cross-joined, but simply returned as list.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>The benefit is grouped extraction is twofold. First, it’s faster
because the list is traversed only once. Second, the de-duplication
works across groups. That is, when <code>dedupe = TRUE</code> (not shown
in the above examples), the fields extracted by the preceding specs are
not extracted by the specs that follow.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Currently <code>groups</code> argument works only with
the top level of the unnest specification.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
